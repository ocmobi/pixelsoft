<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="format-detection" content="telephone=no" />
		<meta name="msapplication-tap-highlight" content="no" />
		<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, target-densitydpi=device-dpi" />
		<title>Pixelsoft</title>
		
		<style type="text/css">
		body
		{
			/*match site logo/background*/
			background-color: #2B2B2B;
		}
		</style>
	</head>
	<body>

	<!-- load last, allows body to load before javascript blocks -->
	<script type="text/javascript" src="phonegap.js"></script>
	<script type="text/javascript" src="jquery-2.1.4.min"></script> 
	<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=true"></script> 
	
	<script type="text/javascript">
	//var address = {city:"", state:"", zip:"", country:"", address:""};
	
	//var offline = false;
	
	//var push = null;
	
	//var splash = true;
	
	//on device ready begin app
	document.addEventListener("deviceready", onDeviceReady, false);
	
	//function checkConnection()
	//{
	//	offline = (navigator.connection.type == Connection.NONE || navigator.connection.type == Connection.UNKNOWN) ? true : false;
	//}
	
	function onDeviceReady()
    	{
    	//navigator.splashscreen.show();
    	
    	 /*check network and poll for connection every 5 seconds*/
	 //checkNetwork();
	//setTimeout( function(){
	//	checkNetwork();
	
	//}, 5000 );
	
	/*begin async geolocation lookup*/
	navigator.geolocation.getCurrentPosition(onSuccessGeolocation, onErrorGeolocation);
	
	 /*push notification object*/
	 //push = window.plugins.pushNotification;

    	 /*push notification init*/
    	 //initPush();

         //begin opening domain (hidden) and attatch event handlers
         var browser = cordova.InAppBrowser.open('http://www.pixelsoft.com.sa', '_blank', 'location=no,toolbar=no,hidden=no,zoom=no,hardwareback=yes,EnableViewPortScale=yes');

	 //browser.addEventListener('loadstart', function(event){
	 //});
	 
         //once load has completed, stop splash and show browser
         browser.addEventListener('loadstop', function(event)
         {
             //one time only on init
             //if( splash == true )
             //{
                 //hide splash
                 //navigator.splashscreen.hide();

                 //show browser
                 //browser.show();

                 //mark indicator
                 //splash = false;
             //}
             
		/*on specific pages populate address, note that we are in the app and we have to inject javascript
		into the site in order to manipulate the dom which does not reside in the app
		*/
		
		/*
		if( event.url.match("^https?:\/\/(www\.)?pixelsoft\.com\.sa\/online-services\/register") )
		{
				browser.executeScript({ code: "
					$('input[name=\"address1\"]').val( "+address.address+" );
					$('input[name=\"city\"]').val( "+address.city+" );
					$('input[name=\"postcode\"]').val( "+address.zip+" );
					$('input[name=\"state\"]').val( "+address.state+" );
		
					if( $('select[name=\"country\"] option[value=\"" + address.country.toUpperCase() + "\"]').length > 0 )
					{
						$('select[name=\"country\"] option[value=\"" + address.country.toUpperCase() + "\"]').prop('selected', true);
					}
				" });
		}
		else if( event.url.match("^https?:\/\/(www\.)?pixelsoft\.com\.sa\/online-services\/cart\/\?a=checkout") )
		{
				browser.executeScript({ code: "
					$('input[name=\"address1\"]').val( "+address.address+" );
					$('input[name=\"city\"]').val( "+address.city+" );
					$('input[name=\"postcode\"]').val( "+address.zip+" );
					$('input[name=\"state\"]').val( "+address.state+" );
		
					if( $('select[name=\"country\"] option[value=\"" + address.country.toUpperCase() + "\"]').length > 0 )
					{
						$('select[name=\"country\"] option[value=\"" + address.country.toUpperCase() + "\"]').prop('selected', true);
					}
				" });
		}       
		*/
         });

         //browser.addEventListener('exit', function(event) {
         //	 /*quit the app*/
         //    //navigator.app.exitApp();
         //});
    }

	// onSuccess Geolocation
	function onSuccessGeolocation(position) {
		var geocoder = new google.maps.Geocoder();
		alert(position.coords.latitude + ' - ' + position.coords.longitude);
		geocoder.geocode({'latLng': new google.maps.LatLng(position.coords.latitude, position.coords.longitude)},
			function(data,status){
				alert('here 1');
				if(status == google.maps.GeocoderStatus.OK)
				{
					alert('here 2');
					var addy = data[1].formatted_address;
					for(var i=0; i<data[1].address_components.length; i++)
					{
						if( data[1].address_components[i].types[0] == "country" )
						{
							address.country = data[1].address_components[i].short_name;
						}
						else if( data[1].address_components[i].types[0] == "street_address" )
						{
							address.address = data[1].address_components[i].long_name;
						}
						else if( data[1].address_components[i].types[0] == "postal_code" )
						{
							address.zip = data[1].address_components[i].short_name;
						}
						else if(data[1].address_components[i].types[0] == "administrative_area_level_1")
						{
							address.state = data[1].address_components[i].short_name;
						}
						else if( data[1].address_components[i].types[0] == "locality" )
						{
							address.city = data[1].address_components[i].long_name;
						}
					}
					
					navigator.notification.alert(
						address.city + ' - ' + address.state + ' - ' + address.country + ' - ' + address.zip + ' - ' + address.address,
						null,
						'Geolocation',
						'Ok'
					);					
				}
			}
		);
	}

	function onErrorGeolocation(error)
	{
		navigator.notification.alert(
			error.code + ' - ' + error.message,
			null,
			'Geolocation',
			'Ok'
		);
	}

		/*
		function initPush()
		{
			document.addEventListener('push-notification', function(event){
				  var notification = event.notification;
				  var title = notification.title;
				  var userData = notification.userdata;

				  push.setApplicationIconBadgeNumber(0);

				  navigator.notification.alert(notification.aps.alert);

			       if(typeof(userData) != "undefined")
			       {
				 	  showStatusMsg('user data: ' + JSON.stringify(userData));
			       }
			   });
			}

			if (device.platform == 'android' || device.platform == 'Android')
			{
				push.registerDevice({ alert:true,
												  badge:true,
												  sound:true,
												  projectid: "...your GCM project number...",
												  appid : "CDAPP-00000"
												},
												function(status)
												{
													var pushToken = status;
													showStatusMsg('push token: ' + JSON.stringify(pushToken));
												},
												function(status)
												{
													showStatusMsg(JSON.stringify(['failed to register', status]));
												});


			}
			else
			{
				push.registerDevice({ alert:true,
												  badge:true,
												  sound:true,
												  appname: "...your app name...",
												  pw_appid : "CDAPP-00000"
												},
												function(status)
												{
													var pushToken = status;
													showStatusMsg('push token: ' + JSON.stringify(pushToken));
												},
												function(status)
												{
													showStatusMsg(JSON.stringify(['failed to register', status]));
												});

			}

		}
		*/
        </script>
    </body>
</html>
