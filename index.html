<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="format-detection" content="telephone=no" />
		<meta name="msapplication-tap-highlight" content="no" />
		<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, target-densitydpi=device-dpi" />
		<title>Pixelsoft</title>
		
		<style type="text/css">
		</style>
	</head>
	<body>

	<!-- load last, allows body to load before javascript blocks -->
	<script type="text/javascript" src="phonegap.js"></script>
	<script type="text/javascript" src="jquery-2.1.4.min"></script> 
	<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=true"></script> 
	
	<script type="text/javascript">
	var address = {city:"", state:"", zip:"", country:"", address:""};
	
	//var offline = false;
	
	//var push = null;
	
	var splash = true;
	navigator.splashscreen.show();

	//on device ready begin app
	document.addEventListener("deviceready", onDeviceReady, false);
	
	//function checkConnection()
	//{
	//	offline = (navigator.connection.type == Connection.NONE || navigator.connection.type == Connection.UNKNOWN) ? true : false;
	//}
	
	function onDeviceReady()
    	{
    	
    	 /*check network and poll for connection every 5 seconds*/
	 //checkNetwork();
	//setTimeout( function(){
	//	checkNetwork();
	
	//}, 5000 );
	
	/*begin async geolocation lookup*/
	navigator.geolocation.getCurrentPosition(onSuccessGeolocation, onErrorGeolocation);
	
	 /*push notification object*/
	 //push = window.plugins.pushNotification;

    	 /*push notification init*/
    	 //initPush();

         //begin opening domain (hidden) and attatch event handlers
         var browser = cordova.InAppBrowser.open('http://www.pixelsoft.com.sa', '_blank', 'location=no,toolbar=no,hidden=yes,zoom=no,hardwareback=yes,EnableViewPortScale=yes');

	 browser.addEventListener('loadstart', function(event){
	 });
	 
         //once load has completed, stop splash and show browser
         browser.addEventListener('loadstop', function(event)
         {
         	/*manually hide splash later, gives us full load appearance*/
         	setTimeout( function(){
			//one time only on init
			if( splash == true )
			{
			   //show browser
			   browser.show();
			
			   //hide splash
			   navigator.splashscreen.hide();
			
			   //mark indicator
			   splash = false;
			}         		
         	}, 5000);

		/*on specific pages populate address, note that we are in the app and we have to inject javascript
		into the site in order to manipulate the dom which does not reside in the app
		*/
		browser.executeScript({ code: " \
			$('input[name=\"address1\"]').val( '"+address.address+"' ); \
			$('input[name=\"city\"]').val( '"+address.city+"' ); \
			$('input[name=\"postcode\"]').val( '"+address.zip+"' ); \
			$('input[name=\"state\"]').val( '"+address.state+"' ); \
			if( $('select[name=\"country\"] option[value=\"" + address.country.toUpperCase() + "\"]').length > 0 ) \
			{ \
				$('select[name=\"country\"] option[value=\"" + address.country.toUpperCase() + "\"]').prop('selected', true); \
			} \
		" });
         });

         browser.addEventListener('exit', function(event) {
         	/*quit the app*/
             	navigator.app.exitApp();
         });
    }

	// onSuccess Geolocation
	function onSuccessGeolocation(position) {
		var geocoder = new google.maps.Geocoder();
		geocoder.geocode({'latLng': new google.maps.LatLng(position.coords.latitude, position.coords.longitude)},
			function(data,status){
				if(status == google.maps.GeocoderStatus.OK)
				{
					var addy = data[0].formatted_address;
					for(var i=0; i<data[0].address_components.length; i++)
					{
						if( data[0].address_components[i].types[0] == "country" )
						{
							address.country = data[0].address_components[i].short_name;
						}
						else if( data[0].address_components[i].types[0] == "street_number" )
						{
							address.address += data[0].address_components[i].long_name;
						}
						else if( data[0].address_components[i].types[0] == "route" )
						{
							address.address += data[0].address_components[i].long_name;
						}
						else if( data[0].address_components[i].types[0] == "postal_code" )
						{
							address.zip = data[0].address_components[i].short_name;
						}
						else if(data[0].address_components[i].types[0] == "administrative_area_level_1")
						{
							address.state = data[0].address_components[i].short_name;
						}
						else if( data[0].address_components[i].types[0] == "locality" )
						{
							address.city = data[0].address_components[i].long_name;
						}
					}
				}
			}
		);
	}

	function onErrorGeolocation(error)
	{
		navigator.notification.alert(
			error.code + ' - ' + error.message,
			null,
			'Geolocation',
			'Ok'
		);
	}

		/*
		function initPush()
		{
			document.addEventListener('push-notification', function(event){
				  var notification = event.notification;
				  var title = notification.title;
				  var userData = notification.userdata;

				  push.setApplicationIconBadgeNumber(0);

				  navigator.notification.alert(notification.aps.alert);

			       if(typeof(userData) != "undefined")
			       {
				 	  showStatusMsg('user data: ' + JSON.stringify(userData));
			       }
			   });
			}

			if (device.platform == 'android' || device.platform == 'Android')
			{
				push.registerDevice({ alert:true,
												  badge:true,
												  sound:true,
												  projectid: "...your GCM project number...",
												  appid : "CDAPP-00000"
												},
												function(status)
												{
													var pushToken = status;
													showStatusMsg('push token: ' + JSON.stringify(pushToken));
												},
												function(status)
												{
													showStatusMsg(JSON.stringify(['failed to register', status]));
												});


			}
			else
			{
				push.registerDevice({ alert:true,
												  badge:true,
												  sound:true,
												  appname: "...your app name...",
												  pw_appid : "CDAPP-00000"
												},
												function(status)
												{
													var pushToken = status;
													showStatusMsg('push token: ' + JSON.stringify(pushToken));
												},
												function(status)
												{
													showStatusMsg(JSON.stringify(['failed to register', status]));
												});

			}

		}
		*/
        </script>
    </body>
</html>
